<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GADKk æµåŠ¨æ€§çŸ¿æ±  - Login Edition</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js" integrity="sha512-FDcVY+g7vc55dy4kJftq9riI+YYTwzOE5x8WiFBYJwKm8cwSE3qM15rDk4PlnDlZjun9HRjKqJNO4n3Kg54Q6A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://unpkg.com/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        /* --- æ ·å¼ä¿æŒä¸å˜ --- */
        * { box-sizing: border-box; }
        body { background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%); color: #e0e0e0; font-family: 'Inter', sans-serif; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 20px; overflow-x: hidden; }
        .app-container { width: 100%; max-width: 480px; position: relative; z-index: 10; }
        .money-rain-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; z-index: 0; pointer-events: none; perspective: 800px; }
        .bill { position: absolute; top: -150px; width: 100px; height: 42px; background-color: #f0f5f0; background-image: radial-gradient(ellipse at center, transparent 60%, rgba(46, 125, 50, 0.1) 100%), repeating-linear-gradient(45deg, transparent, transparent 2px, rgba(0,0,0,0.05) 3px); border: 4px solid #2e7d32; border-radius: 2px; box-shadow: 0 0 5px rgba(0,0,0,0.2); animation: fall linear infinite; opacity: 0.9; display: flex; justify-content: center; align-items: center; }
        .bill::before { content: ''; position: absolute; width: 30px; height: 36px; background: #dcdcdc; border: 1px solid #2e7d32; border-radius: 50%; opacity: 0.8; }
        .bill::after { content: '100'; position: absolute; width: 100%; height: 100%; display: flex; justify-content: space-between; align-items: flex-start; padding: 2px 4px; font-family: 'Times New Roman', serif; font-weight: bold; font-size: 10px; color: #1b5e20; line-height: 1; }
        .bill-inner-text { position: absolute; bottom: 2px; right: 4px; font-family: 'Times New Roman', serif; font-weight: bold; font-size: 10px; color: #1b5e20; }
        @keyframes fall { 0% { transform: translateY(-100px) rotateX(0deg) rotateY(0deg) rotateZ(0deg); opacity: 0; } 10% { opacity: 1; } 100% { transform: translateY(110vh) rotateX(360deg) rotateY(180deg) rotateZ(45deg); opacity: 0.9; } }
        .navbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .logo { font-size: 26px; font-weight: 800; font-family: 'Rajdhani', sans-serif; background: linear-gradient(to right, #00FFA3, #00C2FF); -webkit-background-clip: text; -webkit-text-fill-color: transparent; letter-spacing: 2px; text-shadow: 0 0 15px rgba(0, 255, 163, 0.5); }
        .wallet-badge { background: rgba(0, 255, 163, 0.1); padding: 8px 16px; border-radius: 30px; font-size: 13px; font-weight: 600; color: #00FFA3; border: 1px solid rgba(0, 255, 163, 0.3); cursor: pointer; transition: 0.3s; backdrop-filter: blur(5px); }
        .wallet-badge:hover { background: rgba(0, 255, 163, 0.2); box-shadow: 0 0 15px rgba(0, 255, 163, 0.3); }
        .card { background: rgba(20, 20, 30, 0.6); backdrop-filter: blur(20px) saturate(180%); -webkit-backdrop-filter: blur(20px) saturate(180%); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 24px; padding: 25px; margin-bottom: 25px; box-shadow: 0 15px 35px rgba(0,0,0,0.5); transition: transform 0.3s; }
        .card-title { color: #aaa; font-size: 12px; text-transform: uppercase; margin-bottom: 15px; font-weight: 700; letter-spacing: 1.5px; font-family: 'Rajdhani', sans-serif; }
        .reward-card { background: linear-gradient(160deg, rgba(255, 215, 0, 0.1) 0%, rgba(20, 20, 30, 0.6) 60%); border: 1px solid rgba(255, 215, 0, 0.3); box-shadow: 0 10px 30px rgba(255, 215, 0, 0.15); }
        .reward-val { font-size: 42px; font-weight: 800; font-family: 'Rajdhani', sans-serif; background: linear-gradient(to bottom, #FFD700, #FFA500); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0 0 25px rgba(255, 215, 0, 0.4); margin-bottom: 5px; }
        .reward-unit { font-size: 14px; color: #FFD700; opacity: 0.8; font-family: 'Rajdhani', sans-serif; }
        .action-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; font-family: 'Rajdhani', sans-serif; }
        .balance-text { font-size: 13px; color: #888; }
        .input-box { width: 100%; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); color: #fff; padding: 15px; border-radius: 12px; font-size: 18px; font-family: 'Rajdhani', sans-serif; font-weight: bold; margin: 10px 0 20px 0; outline: none; transition: 0.3s; }
        .input-box:focus { border-color: #00FFA3; box-shadow: 0 0 15px rgba(0, 255, 163, 0.2); background: rgba(0,0,0,0.5); }
        .btn { width: 100%; padding: 18px; border-radius: 12px; border: none; font-size: 16px; font-weight: 800; cursor: pointer; transition: all 0.3s; margin-top: 5px; font-family: 'Inter', sans-serif; position: relative; overflow: hidden; }
        .btn:active { transform: scale(0.97); }
        .btn-gold { background: linear-gradient(135deg, #FFD700, #FF8C00); color: #000; box-shadow: 0 5px 20px rgba(255, 215, 0, 0.4); }
        .btn-green { background: linear-gradient(135deg, #00FFA3, #00C2FF); color: #000; box-shadow: 0 5px 20px rgba(0, 255, 163, 0.4); }
        .btn-red { background: linear-gradient(135deg, #FF4500, #C21500); color: #fff; box-shadow: 0 5px 20px rgba(255, 69, 0, 0.4); }
        .btn-approve { background: rgba(255,255,255,0.1); color: #fff; border: 1px solid rgba(255,255,255,0.2); }
        .tabs { display: flex; gap: 15px; margin-bottom: 20px; background: rgba(0,0,0,0.3); padding: 5px; border-radius: 14px; }
        .tab-btn { flex: 1; padding: 12px; background: transparent; color: #888; border-radius: 10px; cursor: pointer; text-align: center; font-size: 14px; font-weight: 600; transition: 0.3s; }
        .tab-btn.active { background: rgba(40, 40, 50, 0.8); color: #fff; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        #tab-stake.active { color: #00FFA3; text-shadow: 0 0 10px rgba(0, 255, 163, 0.3); }
        #tab-unstake.active { color: #FF4500; text-shadow: 0 0 10px rgba(255, 69, 0, 0.3); }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="money-rain-container" id="moneyRain"></div>

<div class="app-container">
    <div class="navbar">
        <div class="logo">GADKk FARM</div>
        <div id="connectBtn" class="wallet-badge" onclick="connectWallet()">ğŸ“¡ ç‚¹å‡»è¿æ¥é’±åŒ…</div>
    </div>

    <div class="card reward-card">
        <div class="card-title">âœ¨ å¾…é¢†å–åˆ†çº¢ (Pending Rewards)</div>
        <div class="reward-val" id="pendingReward">0.0000</div>
        <div class="reward-unit">GADKk Token</div>
        <button class="btn btn-gold" onclick="claim()">ğŸ’° ä¸€é”®é¢†å– (Harvest)</button>
    </div>

    <div class="card">
        <div class="tabs">
            <div class="tab-btn active" onclick="switchTab('stake')" id="tab-stake">ğŸŸ¢ è´¨æŠ¼æŒ–çŸ¿</div>
            <div class="tab-btn" onclick="switchTab('unstake')" id="tab-unstake">ğŸ”´ èµå›æœ¬é‡‘</div>
        </div>

        <div id="stake-panel">
            <div class="action-row">
                <span style="color:#00FFA3; font-weight:bold;">å­˜å…¥ LP</span>
                <span class="balance-text">é’±åŒ…ä½™é¢: <span id="walletLpBal" style="color:#fff; font-weight:bold;">0.00</span></span>
            </div>
            <input type="number" id="stakeInput" class="input-box" placeholder="è¯·è¾“å…¥è´¨æŠ¼æ•°é‡...">
            <div id="allowanceSection">
                <button class="btn btn-approve" id="approveBtn" onclick="approveLP()">ğŸ”“ ç¬¬ä¸€æ­¥ï¼šæˆæƒ LP (Approve)</button>
            </div>
            <button class="btn btn-green hidden" id="stakeBtn" onclick="depositLP()">âš¡ ç¬¬äºŒæ­¥ï¼šç¡®è®¤è´¨æŠ¼ (Stake)</button>
        </div>

        <div id="unstake-panel" class="hidden">
            <div class="action-row">
                <span style="color:#FF4500; font-weight:bold;">å–å‡º LP</span>
                <span class="balance-text">å·²è´¨æŠ¼: <span id="stakedLpBal" style="color:#fff; font-weight:bold;">0.00</span></span>
            </div>
            <input type="number" id="unstakeInput" class="input-box" placeholder="è¯·è¾“å…¥èµå›æ•°é‡...">
            <button class="btn btn-red" onclick="withdrawLP()">ğŸ“¤ ç¡®è®¤èµå› (Withdraw)</button>
        </div>
    </div>
    
    <div style="text-align:center; color:#666; font-size:12px; margin-top:25px; font-family: 'Rajdhani', sans-serif; letter-spacing: 1px;">
        GADKk Ecosystem | Future Finance
    </div>
</div>

<script>
    // ç¾é‡‘é›¨åŠ¨ç”»
    function createMoneyRain() { const container = document.getElementById('moneyRain'); for (let i = 0; i < 20; i++) generateBill(container); }
    function generateBill(container) { const bill = document.createElement('div'); bill.classList.add('bill'); const innerText = document.createElement('div'); innerText.classList.add('bill-inner-text'); innerText.innerText = '100'; bill.appendChild(innerText); const startLeft = Math.random() * 100; const duration = Math.random() * 5 + 5; const delay = Math.random() * 5; const scale = Math.random() * 0.5 + 0.5; bill.style.left = startLeft + 'vw'; bill.style.animationDuration = duration + 's'; bill.style.animationDelay = delay + 's'; bill.style.transform = `scale(${scale})`; container.appendChild(bill); bill.addEventListener('animationiteration', () => { bill.style.left = Math.random() * 100 + 'vw'; }); }
    window.onload = createMoneyRain;

    // çœŸå®åˆçº¦é…ç½®
    const POOL_ADDR = "0x75bB76C3fc354CE2f078d613C8e6D3daFeE19797"; 
    const PAIR_ADDR = "0x5B06dc147F363aa0111549fb5EA992A40feda6fC"; 
    const ABI_POOL = ["function pendingReward(address) view returns (uint256)","function deposit(uint256) external","function withdraw(uint256) external","function userInfo(address) view returns (uint256 amount, uint256 rewardDebt)"];
    const ABI_ERC20 = ["function balanceOf(address) view returns (uint256)","function approve(address, uint256) external returns (bool)","function allowance(address, address) view returns (uint256)"];

    // é“¾é…ç½®ï¼ˆå‡è®¾æ˜¯ BSC Mainnetï¼ŒchainId: 56ï¼‰
    const TARGET_CHAIN_ID = 56;
    const TARGET_CHAIN_HEX = '0x38';
    const RPC_URL = 'https://bsc-dataseed.binance.org/';
    const CHAIN_NAME = 'Binance Smart Chain';
    const NATIVE_CURRENCY = { name: 'BNB', symbol: 'BNB', decimals: 18 };
    const BLOCK_EXPLORER = 'https://bscscan.com';

    let provider, signer, userAddr;

    // âœ… æ ¸å¿ƒï¼šè¿æ¥ + ç­¾åç™»å½•ï¼ˆä¼˜åŒ–ç‰ˆï¼Œæ”¯æŒ WalletConnect å’Œé“¾åˆ‡æ¢ï¼‰
    async function connectWallet() {
        try {
            if (window.ethereum) {
                // Injected provider (e.g., MetaMask extension)
                provider = new ethers.providers.Web3Provider(window.ethereum);
                await provider.send("eth_requestAccounts", []);
            } else {
                // Fallback to WalletConnect for mobile
                const walletProvider = new WalletConnectProvider({
                    rpc: { [TARGET_CHAIN_ID]: RPC_URL },
                    qrcode: true,
                });
                await walletProvider.enable();
                provider = new ethers.providers.Web3Provider(walletProvider);
            }

            // æ£€æŸ¥å¹¶åˆ‡æ¢é“¾
            const network = await provider.getNetwork();
            if (network.chainId !== TARGET_CHAIN_ID) {
                try {
                    await provider.send('wallet_switchEthereumChain', [{ chainId: TARGET_CHAIN_HEX }]);
                } catch (switchError) {
                    if (switchError.code === 4902) { // é“¾æœªæ·»åŠ 
                        await provider.send('wallet_addEthereumChain', [{
                            chainId: TARGET_CHAIN_HEX,
                            chainName: CHAIN_NAME,
                            nativeCurrency: NATIVE_CURRENCY,
                            rpcUrls: [RPC_URL],
                            blockExplorerUrls: [BLOCK_EXPLORER],
                        }]);
                    } else {
                        throw switchError;
                    }
                }
            }

            signer = provider.getSigner();
            userAddr = await signer.getAddress();

            // æ¨¡æ‹Ÿç­¾åç™»å½•
            const timestamp = Math.floor(Date.now() / 1000);
            const msg = `Welcome to GADKk Farm!\n\nWallet: ${userAddr}\nTimestamp: ${timestamp}\n\nPlease sign to verify ownership.`;
            const signature = await signer.signMessage(msg);
            console.log("Login Success! Signature:", signature);

            // æ›´æ–° UI
            document.getElementById("connectBtn").innerText = "âœ… " + userAddr.substring(0,4) + "..." + userAddr.substring(38);
            document.getElementById("connectBtn").style.borderColor = "#00FFA3";
            document.getElementById("connectBtn").style.color = "#00FFA3";
            document.getElementById("connectBtn").style.background = "rgba(0, 255, 163, 0.1)";

            refreshData();

        } catch (e) {
            console.error(e);
            if (e.code === 4001) {
                alert("æ‚¨å–æ¶ˆäº†ç­¾å/è¿æ¥ï¼Œç™»å½•å¤±è´¥ã€‚");
            } else {
                alert("è¿æ¥é”™è¯¯: " + (e.message || JSON.stringify(e)));
            }
        }
    }

    async function refreshData() {
        if(!userAddr) return;
        const pool = new ethers.Contract(POOL_ADDR, ABI_POOL, provider);
        const pair = new ethers.Contract(PAIR_ADDR, ABI_ERC20, provider);
        try {
            const rew = await pool.pendingReward(userAddr);
            document.getElementById("pendingReward").innerText = parseFloat(ethers.utils.formatUnits(rew, 18)).toFixed(4);
            const walletLp = await pair.balanceOf(userAddr);
            document.getElementById("walletLpBal").innerText = parseFloat(ethers.utils.formatUnits(walletLp, 18)).toFixed(4);
            const info = await pool.userInfo(userAddr); 
            document.getElementById("stakedLpBal").innerText = parseFloat(ethers.utils.formatUnits(info[0], 18)).toFixed(4);
            const allow = await pair.allowance(userAddr, POOL_ADDR);
            const allowNum = parseFloat(ethers.utils.formatUnits(allow, 18));
            if (allowNum > 10000) { 
                document.getElementById("approveBtn").style.display = "none"; 
                document.getElementById("stakeBtn").style.display = "block"; 
                document.getElementById("stakeBtn").classList.remove("hidden"); 
            } else { 
                document.getElementById("approveBtn").style.display = "block"; 
                document.getElementById("stakeBtn").style.display = "none"; 
            }
        } catch(e) { 
            console.error(e); 
            alert("æ•°æ®åˆ·æ–°å¤±è´¥: " + e.message);
        }
    }

    async function approveLP() { 
        const pair = new ethers.Contract(PAIR_ADDR, ABI_ERC20, signer); 
        try { 
            const max = ethers.constants.MaxUint256; 
            const tx = await pair.approve(POOL_ADDR, max); 
            alert("æ­£åœ¨æˆæƒ..."); 
            await tx.wait(); 
            alert("âœ… æˆæƒæˆåŠŸ"); 
            refreshData(); 
        } catch(e) { 
            alert("å¤±è´¥: "+e.message); 
        } 
    }

    async function depositLP() { 
        const amt = document.getElementById("stakeInput").value; 
        if(!amt) return alert("è¾“å…¥æ•°é‡"); 
        const pool = new ethers.Contract(POOL_ADDR, ABI_POOL, signer); 
        try { 
            const tx = await pool.deposit(ethers.utils.parseUnits(amt,18)); 
            alert("è´¨æŠ¼ä¸­..."); 
            await tx.wait(); 
            alert("âœ… æˆåŠŸ"); 
            refreshData(); 
        } catch(e) { 
            alert("å¤±è´¥: "+e.message); 
        } 
    }

    async function withdrawLP() { 
        const amt = document.getElementById("unstakeInput").value; 
        if(!amt) return alert("è¾“å…¥æ•°é‡"); 
        const pool = new ethers.Contract(POOL_ADDR, ABI_POOL, signer); 
        try { 
            const tx = await pool.withdraw(ethers.utils.parseUnits(amt,18)); 
            alert("èµå›ä¸­..."); 
            await tx.wait(); 
            alert("âœ… æˆåŠŸ"); 
            refreshData(); 
        } catch(e) { 
            alert("å¤±è´¥: "+e.message); 
        } 
    }

    async function claim() { 
        const pool = new ethers.Contract(POOL_ADDR, ABI_POOL, signer); 
        try { 
            const tx = await pool.deposit(0); 
            alert("é¢†å–ä¸­..."); 
            await tx.wait(); 
            alert("âœ… æˆåŠŸ"); 
            refreshData(); 
        } catch(e) { 
            alert("å¤±è´¥: "+e.message); 
        } 
    }

    function switchTab(type) { 
        if(type==='stake'){ 
            document.getElementById('stake-panel').classList.remove('hidden'); 
            document.getElementById('unstake-panel').classList.add('hidden'); 
            document.getElementById('tab-stake').classList.add('active'); 
            document.getElementById('tab-unstake').classList.remove('active'); 
        } else { 
            document.getElementById('stake-panel').classList.add('hidden'); 
            document.getElementById('unstake-panel').classList.remove('hidden'); 
            document.getElementById('tab-stake').classList.remove('active'); 
            document.getElementById('tab-unstake').classList.add('active'); 
        } 
    }
</script>
</body>
</html>

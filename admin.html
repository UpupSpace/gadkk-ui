<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GADKk æ€»æ§å°</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js" integrity="sha512-FDcVY+g7vc55dy4kJftq9riI+YYTwzOE5x8WiFBYJwKm8cwSE3qM15rDk4PlnDlZjun9HRjKqJNO4n3Kg54Q6A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; }
        body {
            background-color: #050505;
            background-image: linear-gradient(rgba(0, 255, 163, 0.03) 1px, transparent 1px),
            linear-gradient(90deg, rgba(0, 255, 163, 0.03) 1px, transparent 1px);
            background-size: 40px 40px;
            color: #fff; font-family: 'Microsoft YaHei', 'Segoe UI', sans-serif;
            display: flex; flex-direction: column; align-items: center; padding: 20px;
        }
        .container { width: 100%; max-width: 500px; }
        h1 { color: #fff; text-align: center; font-family: 'Rajdhani', sans-serif; letter-spacing: 4px; font-weight: 700; margin-bottom: 30px; text-shadow: 0 0 10px rgba(255,255,255,0.3); }
        .card { background: rgba(20, 20, 20, 0.8); border: 1px solid #333; backdrop-filter: blur(10px); border-radius: 16px; padding: 24px; margin-bottom: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .card-header { display: flex; justify-content: space-between; align-items: center; color: #888; font-size: 13px; margin-bottom: 15px; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; }
        .big-num { font-size: 36px; font-weight: bold; margin-bottom: 5px; font-family: 'Rajdhani', sans-serif; }
        .unit { font-size: 14px; color: #666; font-weight: normal; margin-left: 5px; }
        .spy-box { background: rgba(0, 255, 163, 0.05); border: 1px solid rgba(0, 255, 163, 0.2); border-radius: 12px; padding: 20px; margin-bottom: 20px; text-align: center; }
        .spy-label { color: #00FFA3; font-size: 14px; font-weight: bold; margin-bottom: 5px; letter-spacing: 1px; }
        .spy-value { color: #fff; font-size: 32px; font-weight: bold; text-shadow: 0 0 15px rgba(0, 255, 163, 0.4); font-family: 'Rajdhani', sans-serif; }
        .btn { width: 100%; padding: 16px; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 10px; transition: 0.2s; letter-spacing: 1px; font-family: 'Microsoft YaHei', sans-serif; }
        .btn-connect { background: #1a1a1a; color: #fff; border: 1px solid #444; margin-bottom: 20px; }
        .btn-process { background: linear-gradient(90deg, #00FFA3, #00C2FF); color: #000; box-shadow: 0 0 15px rgba(0, 255, 163, 0.2); }
        .btn-buyback { background: linear-gradient(90deg, #FF4500, #FF0055); color: #fff; box-shadow: 0 0 15px rgba(255, 69, 0, 0.2); }
        .btn-fill { width: auto; padding: 8px 15px; background: #333; color: #fff; font-size: 12px; border-radius: 6px; }
        .input-group { display: flex; gap: 10px; margin-top: 15px; align-items: center; }
        input { flex: 1; background: #000; border: 1px solid #333; color: #fff; padding: 14px; border-radius: 8px; font-size: 16px; outline: none; font-family: 'Rajdhani', sans-serif; }
        input:focus { border-color: #00FFA3; }
    </style>
</head>
<body>

<div class="container">
    <h1>GADKk æ€»æ§å°</h1>
    <button id="connectBtn" class="btn btn-connect" onclick="connectWallet()">ğŸ”‘ è¿æ¥ç®¡ç†å‘˜é’±åŒ…</button>

    <div class="card">
        <div class="card-header"><span>ğŸ›¡ï¸ è‡ªåŠ¨å›æµåŸºé‡‘ (LpFund)</span><span style="color: #00FFA3">â— è¿è¡Œä¸­</span></div>
        <div style="font-size:12px; color:#888;">å¾…åŠ æ± ä»£å¸ (Pending ADKK):</div>
        <div class="big-num" style="color: #00FFA3"><span id="lpFundBalance">0.00</span><span class="unit">ADKK</span></div>
        <button class="btn btn-process" onclick="processLP()">âš¡ æ‰§è¡Œå›æµåŠ æ±  (Process LP)</button>
    </div>

    <div class="card">
        <div class="card-header"><span>ğŸš€ æ™ºèƒ½å›è´­ V5</span><span style="color: #FF4500">â— é—´è°æ¨¡å¼</span></div>
        <div class="spy-box">
            <div class="spy-label">âš ï¸ æ–°å¢å¸‚åœºæŠ›å‹ (æ™ºèƒ½ç›‘æ§)</div>
            <div class="spy-value" id="newPressure">0.00 ADKK</div>
            <div style="font-size:12px; color:#888; margin-top:5px;" id="usdtCostTip">â‰ˆ éœ€è¦ 0.00 USDT æ¥ç›˜</div>
        </div>
        <div style="display:flex; justify-content:space-between; font-size:12px; color:#888;"><span>å›è´­é‡‘åº“ä½™é¢:</span><span style="color:#fff;" id="buybackBalance">0.00 USDT</span></div>
        <div class="input-group">
            <input type="number" id="buyAmount" placeholder="è¾“å…¥ USDT é‡‘é¢">
            <button class="btn btn-fill" onclick="fillRec()">è‡ªåŠ¨å¡«å…¥</button>
        </div>
        <button class="btn btn-buyback" onclick="triggerBuyback()">ğŸ”¥ æ‹‰ç›˜å¹¶å‘é€ (Buy & Send)</button>
        <div style="text-align:center; font-size:12px; color:#444; margin-top:10px;">ç‚¹å‡»åä»£å¸å°†å‘é€è‡³åˆçº¦æŒ‡å®šçš„æ¥æ”¶åœ°å€</div>
    </div>
</div>

<script>
    const GADKK_ADDR    = "0xA1aEE242C69E1c0820d165ef12438e0A5eEd0BbA";
    const LP_FUND_ADDR  = "0xD7bB38219D069dfDD4F09Fdf568493A4B7d7E4fd";
    const BUYBACK_ADDR  = "0x3f22B4f6d76dD740AE3E22eb25bC22a884971ADB"; // V5
    const MARKETING_ADDR= "0x2DBE6300514C4D0Cd7456348512370D3A68d4c1E"; 
    const USDT_ADDR = "0x55d398326f99059fF775485246999027B3197955";
    const MARKETING_TAX_RATE = 0.05;

    let provider, signer, recUSDT = 0;
    const ABI_TOKEN = ["function balanceOf(address) view returns (uint256)", "function getPrice() view returns (uint256)"];
    const ABI_LP = ["function process() external"];
    const ABI_BUY = ["function buyUSDT(uint256) external", "function lastMarkBalance() view returns (uint256)"];

    async function connectWallet() {
        if (!window.ethereum) return alert("è¯·å®‰è£… MetaMask å°ç‹ç‹¸é’±åŒ…");
        try {
            provider = new ethers.providers.Web3Provider(window.ethereum);
            await provider.send("eth_requestAccounts", []);
            signer = provider.getSigner();
            userAddr = await signer.getAddress();
            document.getElementById("connectBtn").innerText = "âœ… ç®¡ç†å‘˜å·²å°±ç»ª";
            document.getElementById("connectBtn").style.borderColor = "#00FFA3";
            document.getElementById("connectBtn").style.color = "#00FFA3";
            refreshData();
        } catch(e) { console.error(e); alert("è¿æ¥å¤±è´¥"); }
    }

    async function refreshData() {
        if(!userAddr) return;
        const token = new ethers.Contract(GADKK_ADDR, ABI_TOKEN, provider);
        const buyback = new ethers.Contract(BUYBACK_ADDR, ABI_BUY, provider);
        const usdt = new ethers.Contract(USDT_ADDR, ABI_TOKEN, provider);
        const lpBal = await token.balanceOf(LP_FUND_ADDR);
        document.getElementById("lpFundBalance").innerText = parseFloat(ethers.utils.formatUnits(lpBal, 18)).toFixed(2);
        const usdtBal = await usdt.balanceOf(BUYBACK_ADDR);
        document.getElementById("buybackBalance").innerText = parseFloat(ethers.utils.formatUnits(usdtBal, 18)).toFixed(2);
        const currentRaw = await token.balanceOf(MARKETING_ADDR);
        const current = parseFloat(ethers.utils.formatUnits(currentRaw, 18));
        const lastRaw = await buyback.lastMarkBalance();
        const last = parseFloat(ethers.utils.formatUnits(lastRaw, 18));
        let diff = current - last;
        if (diff < 0) diff = 0; 
        const pressure = diff / MARKETING_TAX_RATE;
        document.getElementById("newPressure").innerText = pressure.toFixed(2) + " ADKK";
        try {
            const priceRaw = await token.getPrice();
            const price = parseFloat(ethers.utils.formatUnits(priceRaw, 18));
            if(price > 0 && pressure > 0) {
                const cost = pressure / price;
                document.getElementById("usdtCostTip").innerText = `â‰ˆ éœ€è¦ ${cost.toFixed(2)} USDT æ¥ç›˜`;
                recUSDT = cost.toFixed(2);
            }
        } catch(e) {}
    }

    function fillRec() { if(recUSDT > 0) document.getElementById("buyAmount").value = recUSDT; }

    async function processLP() {
        const contract = new ethers.Contract(LP_FUND_ADDR, ABI_LP, signer);
        try { const tx = await contract.process({ gasLimit: 2000000 }); alert("æ­£åœ¨æ‰§è¡ŒåŠ æ± ..."); await tx.wait(); alert("âœ… åŠ æ± æˆåŠŸï¼"); refreshData(); } catch(e) { alert("é”™è¯¯: " + e.message); }
    }
    async function triggerBuyback() {
        const amt = document.getElementById("buyAmount").value; if(!amt) return alert("è¯·è¾“å…¥é‡‘é¢");
        const contract = new ethers.Contract(BUYBACK_ADDR, ABI_BUY, signer);
        try { const weiAmt = ethers.utils.parseUnits(amt, 18); const tx = await contract.buyUSDT(weiAmt, { gasLimit: 500000 }); alert("æ­£åœ¨æ‹‰ç›˜å¹¶å‘é€..."); await tx.wait(); alert("âœ… äº¤æ˜“æˆåŠŸï¼"); refreshData(); } catch(e) { alert("é”™è¯¯: " + e.message); }
    }
</script>
</body>
</html>

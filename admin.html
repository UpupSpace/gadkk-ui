<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GADKk ADMIN v12.1</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #00FFA3; --secondary: #00C2FF; --danger: #FF4500; --dark: #09090b; --card: rgba(24, 24, 27, 0.7); --border: rgba(255,255,255,0.1); }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--dark); background-image: radial-gradient(circle at 50% -20%, #1e1e2e 0%, #000 100%); color: #fff; font-family: 'Inter', sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; min-height: 100vh; margin: 0; }
        .container { width: 100%; max-width: 480px; position: relative; z-index: 10; animation: fadeUp 0.6s ease; }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

        .header { text-align: center; margin-bottom: 30px; }
        h1 { margin: 0; font-family: 'Rajdhani', sans-serif; font-size: 28px; letter-spacing: 2px; color: #fff; text-shadow: 0 0 20px rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center; gap: 10px; }
        
        /* æ ‡ç­¾æ ·å¼ */
        .badge { background: rgba(0, 255, 163, 0.1); border: 1px solid var(--primary); color: var(--primary); padding: 3px 8px; border-radius: 6px; font-size: 11px; font-weight: 800; letter-spacing: 1px; box-shadow: 0 0 10px rgba(0, 255, 163, 0.2); }

        .card { background: var(--card); border: 1px solid var(--border); backdrop-filter: blur(20px); border-radius: 20px; padding: 20px; margin-bottom: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.4); }
        .card-header { display: flex; justify-content: space-between; align-items: center; font-size: 12px; font-weight: 700; color: #888; text-transform: uppercase; margin-bottom: 15px; }
        .dot { width: 6px; height: 6px; border-radius: 50%; display: inline-block; margin-right: 6px; box-shadow: 0 0 8px currentColor; }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .stat-item { background: rgba(0,0,0,0.3); border: 1px solid var(--border); padding: 12px; border-radius: 12px; text-align: center; }
        .stat-label { font-size: 11px; color: #666; margin-bottom: 4px; }
        .stat-val { font-family: 'Rajdhani', sans-serif; font-size: 18px; font-weight: 700; color: #eee; }
        .highlight { color: var(--danger); text-shadow: 0 0 10px rgba(255, 69, 0, 0.3); }

        .btn { width: 100%; padding: 16px; border-radius: 12px; border: none; font-size: 15px; font-weight: 700; cursor: pointer; transition: 0.2s; position: relative; overflow: hidden; margin-top: 5px; }
        .btn:active { transform: scale(0.98); }
        .btn-connect { background: rgba(255,255,255,0.05); color: #ccc; border: 1px solid var(--border); margin-bottom: 20px; }
        .btn-green { background: linear-gradient(135deg, #00FFA3, #00C2FF); color: #000; box-shadow: 0 4px 15px rgba(0, 255, 163, 0.2); }
        .btn-red { background: linear-gradient(135deg, #FF4500, #C21500); color: #fff; box-shadow: 0 4px 15px rgba(255, 69, 0, 0.2); }

        .input-wrap { position: relative; background: #111; border: 1px solid var(--border); border-radius: 12px; display: flex; align-items: center; padding: 0 15px; transition: 0.3s; margin-bottom: 10px; }
        .input-wrap:focus-within { border-color: var(--secondary); box-shadow: 0 0 15px rgba(0, 194, 255, 0.1); }
        .input-wrap input { width: 100%; background: none; border: none; color: #fff; font-size: 18px; padding: 16px 0; font-family: 'Rajdhani', sans-serif; outline: none; }
        .suffix { font-size: 12px; color: #666; font-weight: bold; }

        .tabs { display: flex; background: rgba(0,0,0,0.3); padding: 4px; border-radius: 10px; margin-bottom: 20px; border: 1px solid var(--border); }
        .tab { flex: 1; padding: 10px; text-align: center; font-size: 13px; color: #666; cursor: pointer; border-radius: 8px; transition: 0.3s; font-weight: 600; }
        .tab.active { background: rgba(255,255,255,0.1); color: #fff; }
        .tab.active.buy { color: var(--secondary); }
        .tab.active.burn { color: var(--danger); }

        .capsule-row { display: flex; gap: 8px; justify-content: flex-end; margin-bottom: 8px; flex-wrap: wrap; }
        .capsule { padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 600; cursor: pointer; border: 1px solid transparent; transition: 0.2s; display: flex; align-items: center; gap: 4px; }
        .cap-gold { background: rgba(255, 215, 0, 0.1); color: #FFD700; border-color: rgba(255, 215, 0, 0.2); }
        .cap-gold:active { background: rgba(255, 215, 0, 0.2); transform: scale(0.95); }
        .cap-red { background: rgba(255, 69, 0, 0.1); color: #FF4500; border-color: rgba(255, 69, 0, 0.2); }
        .cap-red:active { background: rgba(255, 69, 0, 0.2); transform: scale(0.95); }
        .cap-blue { background: rgba(0, 194, 255, 0.1); color: #00C2FF; border-color: rgba(0, 194, 255, 0.2); }
        
        .helper-text { text-align: right; font-size: 12px; height: 20px; color: #555; font-family: 'Rajdhani', sans-serif; }
        .hidden { display: none; }

        .toast-box { position: fixed; top: 20px; right: 20px; z-index: 100; display: flex; flex-direction: column; gap: 10px; }
        .toast { background: rgba(20, 20, 20, 0.95); border-left: 4px solid; padding: 15px 20px; border-radius: 4px; color: #fff; min-width: 280px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); transform: translateX(120%); transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); font-size: 13px; display: flex; align-items: center; backdrop-filter: blur(10px); }
        .toast.show { transform: translateX(0); }
        .t-icon { margin-right: 10px; font-size: 16px; }
    </style>
</head>
<body>

<div class="toast-box" id="toastBox"></div>

<div class="container">
    <div class="header">
        <h1>GADKk ADMIN <span class="badge">PRO v12.1</span></h1>
        <div style="font-size:12px; color:#555; margin-top:5px;">FINANCIAL CONTROL CENTER</div>
    </div>

    <button id="connectBtn" class="btn btn-connect" onclick="connectWallet()">ğŸ”‘ éªŒè¯ç®¡ç†å‘˜èº«ä»½</button>

    <div class="card">
        <div class="card-header">
            <span>ğŸ›¡ï¸ è‡ªåŠ¨å›æµ (LP Fund)</span>
            <span style="color:var(--primary)">â— Active</span>
        </div>
        <div class="grid" style="grid-template-columns: 1fr;">
            <div class="stat-item">
                <div class="stat-label">å¾…åŠ æ± ä»£å¸ (Accumulated)</div>
                <div class="stat-val" style="color:var(--primary)" id="lpFundBalance">--</div>
            </div>
        </div>
        <button class="btn btn-green" onclick="processLP()">âš¡ æ‰§è¡Œå›æµåŠ æ±  (PROCESS)</button>
    </div>

    <div class="card" style="border-color: rgba(255, 69, 0, 0.2);">
        <div class="card-header">
            <span>ğŸš€ æ™ºèƒ½å›è´­ (Auto Buyback)</span>
            <span style="color:var(--danger)">â— Ready</span>
        </div>

        <div class="grid">
            <div class="stat-item"><div class="stat-label">ğŸ¦ è¥é”€é’±åŒ…ä½™é¢</div><div class="stat-val" id="marketingBal">0.00</div></div>
            <div class="stat-item"><div class="stat-label">âš ï¸ ä¼°ç®—æŠ›å‹</div><div class="stat-val highlight" id="marketVolume">0.00</div></div>
            <div class="stat-item"><div class="stat-label">ğŸ“‰ å¾…å¤„ç†ç§¯å‹</div><div class="stat-val" style="color:#FFD700" id="ledgerBacklog">0.00</div></div>
            <div class="stat-item"><div class="stat-label">ğŸ’° USDT é‡‘åº“</div><div class="stat-val" id="usdtBalance">--</div></div>
        </div>

        <div class="tabs">
            <div class="tab active buy" id="tab-usdt" onclick="switchMode('usdt')">æŒ‰é‡‘é¢ä¹° (USDT)</div>
            <div class="tab" id="tab-adkk" onclick="switchMode('adkk')">æŒ‰æ•°é‡ä¹° (ADKK)</div>
        </div>

        <div id="mode-usdt">
            <div class="capsule-row">
                <div class="capsule cap-blue" onclick="fillMaxUSDT()">ğŸ’° å¡«å…¥æœ€å¤§ä½™é¢</div>
            </div>
            <div class="input-wrap">
                <input type="number" id="inputUSDT" placeholder="è¾“å…¥ USDT é‡‘é¢" oninput="calcFromUSDT()">
                <span class="suffix">USDT</span>
            </div>
            <div class="helper-text" id="previewFromUSDT" style="color:var(--secondary)"></div>
            <button class="btn" style="background: var(--secondary); color:#000" onclick="buyByUSDT()">ğŸ”µ ç¡®è®¤ä¹°å…¥ (BUY)</button>
        </div>

        <div id="mode-adkk" class="hidden">
            <div class="capsule-row">
                <div class="capsule cap-gold" onclick="fillBacklog()">ğŸ“‰ å¡«å…¥ç§¯å‹</div>
                <div class="capsule cap-red" onclick="fillVolume()">âš ï¸ å¡«å…¥æŠ›å‹</div>
            </div>
            <div class="input-wrap">
                <input type="number" id="inputADKK" placeholder="è¾“å…¥ ADKK æ•°é‡" oninput="calcFromADKK()">
                <span class="suffix">ADKK</span>
            </div>
            <div class="helper-text" id="previewFromADKK" style="color:var(--danger)"></div>
            <button class="btn btn-red" onclick="buyByADKK()">ğŸ”¥ å¼ºåŠ›æ‹‰ç›˜ (PULL)</button>
        </div>
    </div>
</div>

<script>
    // --- æ ¸å¿ƒé…ç½® ---
    const BUYBACK_ADDR  = "0xa09e77ed31810b6Ec99b39f0E137c83450Fc8127"; 
    const GADKK_ADDR    = "0xA1aEE242C69E1c0820d165ef12438e0A5eEd0BbA"; 
    const LP_FUND_ADDR  = "0xD7bB38219D069dfDD4F09Fdf568493A4B7d7E4fd"; 
    const MARKETING_ADDR= "0x2DBE6300514C4D0Cd7456348512370D3A68d4c1E"; 
    const USDT_ADDR     = "0x55d398326f99059fF775485246999027B3197955"; 
    const PAIR_ADDR     = "0x5B06dc147F363aa0111549fb5EA992A40feda6fC"; 
    const MARKETING_TAX_RATE = 0.05; 

    const ABI_COMMON = ["function balanceOf(address) view returns (uint256)"];
    const ABI_LP = ["function process() external"];
    const ABI_BUY = ["function buyAndAutoSend(uint256 usdtAmount, uint256 backlogReduced) external", "function totalProcessedBacklog() view returns (uint256)"];

    let provider, signer, currentPrice = 0, backlog = 0, volume = 0, vaultBalance = 0;

    function showToast(msg, type='info') {
        const div = document.createElement('div');
        div.className = `toast`;
        div.style.borderLeftColor = type==='success'?'var(--primary)':(type==='error'?'var(--danger)':'var(--secondary)');
        const icon = type==='success'?'âœ…':(type==='error'?'âŒ':'â„¹ï¸');
        div.innerHTML = `<span class="t-icon">${icon}</span><span>${msg}</span>`;
        document.getElementById('toastBox').appendChild(div);
        setTimeout(()=>div.classList.add('show'),10);
        setTimeout(()=>{div.classList.remove('show');setTimeout(()=>div.remove(),300)},3000);
    }

    function switchMode(mode) {
        document.getElementById('mode-usdt').classList.add('hidden');
        document.getElementById('mode-adkk').classList.add('hidden');
        document.getElementById('tab-usdt').classList.remove('active','buy');
        document.getElementById('tab-adkk').classList.remove('active','burn');
        
        document.getElementById(`mode-${mode}`).classList.remove('hidden');
        const btn = document.getElementById(`tab-${mode}`);
        btn.classList.add('active');
        if(mode==='usdt') btn.classList.add('buy');
        if(mode==='adkk') btn.classList.add('burn');
    }

    async function connectWallet() {
        if(!window.ethereum) return showToast("è¯·å®‰è£… MetaMask", "error");
        try {
            provider = new ethers.providers.Web3Provider(window.ethereum);
            await provider.send("eth_requestAccounts", []);
            signer = provider.getSigner();
            const addr = await signer.getAddress();
            document.getElementById("connectBtn").innerText = `âœ… ${addr.substring(0,6)}...`;
            document.getElementById("connectBtn").style.borderColor = "var(--primary)";
            document.getElementById("connectBtn").style.color = "var(--primary)";
            showToast("ç³»ç»Ÿè¿æ¥æˆåŠŸ", "success");
            refreshData();
            setInterval(refreshData, 8000);
        } catch(e) { showToast("è¿æ¥å–æ¶ˆ", "info"); }
    }

    async function refreshData() {
        if(!provider) return;
        const tkCt = new ethers.Contract(GADKK_ADDR, ABI_COMMON, provider);
        const usdtCt = new ethers.Contract(USDT_ADDR, ABI_COMMON, provider);
        const buyCt = new ethers.Contract(BUYBACK_ADDR, ABI_BUY, provider);

        try {
            const lpVal = await tkCt.balanceOf(LP_FUND_ADDR);
            document.getElementById("lpFundBalance").innerText = parseFloat(ethers.utils.formatUnits(lpVal, 18)).toFixed(2);
            
            const usdtVal = await usdtCt.balanceOf(BUYBACK_ADDR);
            vaultBalance = parseFloat(ethers.utils.formatUnits(usdtVal, 18));
            document.getElementById("usdtBalance").innerText = vaultBalance.toFixed(2);

            const pAdkk = parseFloat(ethers.utils.formatUnits(await tkCt.balanceOf(PAIR_ADDR), 18));
            const pUsdt = parseFloat(ethers.utils.formatUnits(await usdtCt.balanceOf(PAIR_ADDR), 18));
            if(pAdkk>0) currentPrice = pUsdt / pAdkk;

            const realMark = parseFloat(ethers.utils.formatUnits(await tkCt.balanceOf(MARKETING_ADDR), 18));
            document.getElementById("marketingBal").innerText = realMark.toFixed(2);
            
            const processed = parseFloat(ethers.utils.formatUnits(await buyCt.totalProcessedBacklog(), 18));
            backlog = Math.max(0, realMark - processed);
            document.getElementById("ledgerBacklog").innerText = backlog.toFixed(2);
            
            volume = backlog / MARKETING_TAX_RATE;
            document.getElementById("marketVolume").innerText = volume.toFixed(2);
        } catch(e) { console.error(e); }
    }

    function calcFromUSDT() {
        const val = parseFloat(document.getElementById("inputUSDT").value||0);
        if(currentPrice>0) document.getElementById("previewFromUSDT").innerText = `â‰ˆ ${(val/currentPrice).toFixed(2)} ADKK`;
    }
    function calcFromADKK() {
        const val = parseFloat(document.getElementById("inputADKK").value||0);
        const cost = val * currentPrice;
        const el = document.getElementById("previewFromADKK");
        el.innerText = `â‰ˆ ${cost.toFixed(4)} USDT`;
        el.style.color = cost > vaultBalance ? '#FF4500' : 'var(--danger)';
        if(cost > vaultBalance) el.innerText += " (ä½™é¢ä¸è¶³)";
    }
    
    function fillMaxUSDT() { document.getElementById("inputUSDT").value = vaultBalance; calcFromUSDT(); }
    function fillBacklog() { document.getElementById("inputADKK").value = backlog.toFixed(2); calcFromADKK(); }
    function fillVolume() { document.getElementById("inputADKK").value = volume.toFixed(2); calcFromADKK(); }

    async function executeBuy(usdtAmt, adkkAmt) {
        if(!signer) return showToast("è¯·å…ˆè¿æ¥é’±åŒ…", "error");
        const ct = new ethers.Contract(BUYBACK_ADDR, ABI_BUY, signer);
        try {
            showToast("æ­£åœ¨å‘é€äº¤æ˜“...", "info");
            const recordAmt = adkkAmt > backlog ? backlog : adkkAmt;
            const tx = await ct.buyAndAutoSend(
                ethers.utils.parseUnits(usdtAmt.toFixed(18), 18),
                ethers.utils.parseUnits(recordAmt.toFixed(18), 18),
                { gasLimit: 1000000 }
            );
            showToast("äº¤æ˜“å·²å‘é€", "info");
            await tx.wait();
            showToast("ğŸš€ æ‹‰ç›˜æˆåŠŸï¼", "success");
            document.getElementById("inputUSDT").value = "";
            document.getElementById("inputADKK").value = "";
            refreshData();
        } catch(e) { showToast(e.reason || e.message, "error"); }
    }

    function buyByUSDT() {
        const val = parseFloat(document.getElementById("inputUSDT").value);
        if(!val || val<=0) return showToast("è¾“å…¥æ— æ•ˆ", "error");
        if(val > vaultBalance) return showToast("ä½™é¢ä¸è¶³", "error");
        executeBuy(val, val/currentPrice);
    }

    function buyByADKK() {
        const val = parseFloat(document.getElementById("inputADKK").value);
        if(!val || val<=0) return showToast("è¾“å…¥æ— æ•ˆ", "error");
        const cost = val * currentPrice;
        if(cost > vaultBalance) return showToast("é‡‘åº“ä½™é¢ä¸è¶³", "error");
        executeBuy(cost, val);
    }

    async function processLP() {
        if(!signer) return showToast("è¯·å…ˆç™»å½•", "error");
        const ct = new ethers.Contract(LP_FUND_ADDR, ABI_LP, signer);
        try {
            showToast("æ‰§è¡Œå›æµåŠ æ± ...", "info");
            const tx = await ct.process({ gasLimit: 3000000 });
            await tx.wait();
            showToast("âœ… åŠ æ± æˆåŠŸ", "success");
            refreshData();
        } catch(e) { showToast(e.message, "error"); }
    }
</script>
</body>
</html>
